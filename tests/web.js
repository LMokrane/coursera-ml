require('dotenv').config();
const test = require('tape');
const request = require('supertest');
const serveur = require('serveur');
const Learning = require('Learning');

test('Web server', t => {
  t.plan(6);

  request(serveur)
    .get('/')
    .expect(404)
    .end((err, res) => {
      const msg = 'Erreur 404 : /';
      if (err) return t.fail(msg);
      t.pass(msg);
    });

  request(serveur)
    .get(`/${process.env.APP}`)
    .expect(404)
    .end((err, res) => {
      const msg = 'Erreur 404 : /coursera';
      if (err) return t.fail(msg);
      t.pass(msg);
    });

  request(serveur)
    .get(`/${process.env.APP}/mnist`)
    .expect(404)
    .end((err, res) => {
      const msg = 'Erreur 404 : /coursera/mnist';
      if (err) return t.fail(msg);
      t.pass(msg);
    });

  let data = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.376,0.878,0.996,0.996,0.91,0.184,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.208,0.698,0.969,0.969,0.855,0.855,0.996,0.71,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.345,0.922,0.996,0.671,0.212,0,0.384,0.996,0.796,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.016,0.275,0.957,0.992,0.514,0.039,0,0.086,0.859,0.996,0.325,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.09,0.576,0.992,0.992,0.404,0,0,0.122,0.624,0.992,0.996,0.651,0.235,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.553,0.996,0.996,0.373,0,0,0.11,0.612,0.996,0.906,0.702,0.996,0.306,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.208,0.996,0.953,0.267,0.012,0,0,0.627,0.914,0.659,0.612,0.996,0.984,0.282,0,0,0,0,0,0,0,0,0,0,0,0,0,0.376,0.922,0.996,0.529,0,0,0,0,0.384,0,0.537,0.992,0.996,0.529,0,0,0,0,0,0,0,0,0,0,0,0,0,0.051,0.902,0.992,0.722,0.012,0,0,0,0,0.161,0.8,0.984,0.992,0.871,0.071,0,0,0,0,0,0,0,0,0,0,0,0,0,0.31,0.992,0.843,0.09,0,0,0,0,0.62,0.957,0.992,0.992,0.992,0.325,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.31,0.996,0.698,0.055,0.231,0.498,0.671,0.996,1,0.996,0.996,0.996,0.906,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.165,0.925,0.992,0.878,0.992,0.992,0.98,0.914,0.447,0.392,0.992,0.98,0.416,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.373,0.922,0.996,0.969,0.565,0.259,0,0,0.725,0.992,0.835,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.059,0.075,0.071,0,0,0,0.482,0.98,0.941,0.267,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.298,0.996,0.961,0.275,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.039,0.82,1,0.533,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.804,0.992,0.976,0.345,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.027,0.427,0.969,0.992,0.384,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.137,0.992,0.992,0.431,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.314,0.992,0.431,0.055,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

  request(serveur)
    .post(`/${process.env.APP}/`)
    .send(data)
    .expect(404)
    .end((err, res) => {
      const msg = '404: POST /coursera';
      if (err) return t.fail(msg);
      t.pass(msg);
    });

  request(serveur)
    .post(`/${process.env.APP}/mnist`)
    .send(data)
    .expect(404)
    .end((err, res) => {
      const msg = '404: POST /coursera/mnist';
      if (err) return t.fail(msg);
      t.pass(msg);
    });

  request(serveur)
    .post(`/${process.env.APP}/mnist/predict`)
    .send(data)
    .expect(200)
    .end((err, res) => {
      const msg = 'POST /coursera/mnist/predict';
      if (err) return t.fail(msg);
      t.pass(msg);
    });
});
